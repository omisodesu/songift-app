rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 管理者判定ヘルパー関数
    // 注: Security Rulesでは環境変数を読めないため、ここに直接記載する必要があります
    function isAdmin() {
      return request.auth != null &&
             request.auth.token.email in [
               'fukui@tfs.jp.net',
               'gadandan@tfs.jp.net'
               // 他の管理者メールアドレスをここに追加
             ];
    }

    // orders コレクション
    match /orders/{orderId} {
      // 読み取り: 管理者のみ
      allow read: if isAdmin();

      // 作成: 禁止（Cloud Functions経由のみ）
      allow create: if false;

      // 更新: 管理者のみ
      allow update: if isAdmin();

      // 削除: 管理者のみ
      allow delete: if isAdmin();
    }

    // rate_limits コレクション: Cloud Functions内部用
    match /rate_limits/{doc} {
      // 外部からのアクセスを完全に禁止
      allow read, write: if false;
    }

    // デフォルト: すべて拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
